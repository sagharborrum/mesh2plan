<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>v32 — Strip Merge</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { background: #1a1a2e; color: #eee; font-family: system-ui, sans-serif; line-height: 1.6; }
.container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; }
h1 { font-size: 2em; margin-bottom: 10px; }
.badge { display: inline-block; padding: 4px 10px; border-radius: 12px; font-size: 0.8em; margin-right: 5px; }
.best { background: rgba(0,229,255,0.2); color: #00E5FF; }
.multi { background: rgba(255,0,128,0.2); color: #FF0080; }
.desc { color: #aaa; margin: 15px 0; max-width: 800px; }
.results { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px; }
.result-card { background: rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; }
.result-card h3 { color: #00E5FF; margin-bottom: 10px; }
.result-card img { width: 100%; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); }
table { width: 100%; margin-top: 15px; border-collapse: collapse; }
td, th { padding: 8px 12px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); }
th { color: #00E5FF; font-weight: 600; }
.metric { font-size: 1.4em; font-weight: bold; color: #fff; }
.label { font-size: 0.85em; color: #888; }
.stats { display: flex; gap: 30px; margin: 20px 0; }
.stat { text-align: center; }
a { color: #00E5FF; }
.back { display: inline-block; margin-bottom: 20px; color: #888; text-decoration: none; }
.back:hover { color: #fff; }
.algo { background: rgba(255,255,255,0.03); border-radius: 8px; padding: 15px; margin: 15px 0; }
.algo code { background: rgba(0,229,255,0.1); padding: 2px 6px; border-radius: 4px; color: #00E5FF; }
</style>
</head>
<body>
<div class="container">
  <a href="index.html" class="back">← Back to index</a>
  <h1>v32 — Strip Merge <span class="badge best">⭐⭐ BEST</span> <span class="badge multi">MULTIROOM</span></h1>
  
  <p class="desc">
    X-axis wall cuts create vertical strips (left / center / right). The center strip is automatically classified as the hallway. Z-axis cuts then split left and right strips into separate rooms if both pieces exceed 4m². Door detection via mask adjacency.
  </p>

  <div class="stats">
    <div class="stat"><div class="metric">3</div><div class="label">Rooms</div></div>
    <div class="stat"><div class="metric">1</div><div class="label">Hallway</div></div>
    <div class="stat"><div class="metric">1</div><div class="label">Closet</div></div>
    <div class="stat"><div class="metric">6</div><div class="label">Doors</div></div>
    <div class="stat"><div class="metric">34.7 m²</div><div class="label">Total Area</div></div>
  </div>

  <div class="algo">
    <strong>Algorithm:</strong>
    <ol style="margin-top:8px; padding-left:20px; color:#ccc;">
      <li>Build density image from projected vertices (cell=0.02m)</li>
      <li>Detect dominant angle → rotate to axis-align walls</li>
      <li>Hough wall detection with NMS → identify wall positions</li>
      <li>Score walls: <code>projection_strength × longest_continuous_run</code></li>
      <li>Select top 2 X cuts + 2 Z cuts (min separation 1.0m)</li>
      <li>Cut room mask along validated wall segments</li>
      <li>Merge fragments by strip (left/center/right based on X cuts)</li>
      <li>Center strip → hallway; small rooms (&lt;4.5m²) → closet</li>
      <li>Door detection via mask adjacency (dilate + overlap)</li>
      <li>Render architectural floor plan</li>
    </ol>
  </div>

  <div class="results">
    <div class="result-card">
      <h3>Multiroom Floor Plan</h3>
      <img src="../results/v32_strip/v30_export_refined_plan.png" alt="v32 multiroom floor plan">
      <table>
        <tr><th>Space</th><th>Area</th><th>Vertices</th></tr>
        <tr><td>Room 1</td><td>10.9 m²</td><td>4</td></tr>
        <tr><td>Room 2</td><td>9.8 m²</td><td>4</td></tr>
        <tr><td>Room 3</td><td>5.3 m²</td><td>4</td></tr>
        <tr><td>Hallway</td><td>4.4 m²</td><td>6</td></tr>
        <tr><td>Closet</td><td>4.3 m²</td><td>4</td></tr>
      </table>
    </div>

    <div class="result-card">
      <h3>Debug Overlay</h3>
      <img src="../results/v32_strip/v30_export_refined_debug.png" alt="v32 debug overlay">
      <p style="margin-top:10px; color:#888; font-size:0.9em;">
        Left: density + wall cuts. Right: room polygons overlaid on density.
        Cyan lines = selected wall cuts. Colors = room assignments.
      </p>
    </div>

    <div class="result-card">
      <h3>Single Room (auto-detected)</h3>
      <img src="../results/v32_single/v30_export_refined_plan.png" alt="v32 single room">
      <p style="margin-top:10px; color:#888; font-size:0.9em;">
        When mask area &lt; 20m², automatically switches to single-room mode.
        Contour extraction with rectilinear simplification. 8-vertex L-shape, 12.3m².
      </p>
    </div>

    <div class="result-card">
      <h3>Key Insights</h3>
      <ul style="padding-left:20px; color:#ccc; margin-top:10px;">
        <li><strong>Strip merging</strong> outperforms generic smallest-first merging</li>
        <li><strong>Center strip = hallway</strong> — reliable for central-corridor apartments</li>
        <li><strong>Mask adjacency</strong> beats polygon edge matching for door detection (wall cut gaps)</li>
        <li><strong>Wall scoring</strong> (strength × run) correctly identifies the strongest interior walls</li>
        <li><strong>Auto mode detection</strong> — mask area threshold separates single vs multiroom</li>
      </ul>
    </div>
  </div>

  <p style="margin-top:30px; color:#666; font-size:0.85em;">
    Branch: <code>research/v32-strip-merge</code> · 
    File: <code>research/v32_strip_merge.py</code> ·
    <a href="https://github.com/sagharborrum/mesh2plan">GitHub</a>
  </p>
</div>
</body>
</html>
